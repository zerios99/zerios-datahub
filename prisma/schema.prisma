generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums for type safety
enum UserRole {
  USER
  ADMIN
}

enum LocationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum PointType {
  NEW
  EDIT
}

model User {
  id        String     @id @default(cuid())
  name      String
  email     String     @unique
  password  String
  role      UserRole   @default(USER)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  locations Location[]

  @@index([email])
}

model Location {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Location info
  name            String  @db.VarChar(255)
  formalPlaceName String? @db.VarChar(255)
  category        String  @db.VarChar(100)
  city            String  @db.VarChar(100)
  street          String? @db.VarChar(255)
  side            String? @db.VarChar(100)
  path            String? @db.VarChar(255)
  dir             String? @db.VarChar(100)
  line            String? @db.VarChar(100)

  // Coordinates
  latitude  Float
  longitude Float

  // Metadata
  status          LocationStatus @default(PENDING)
  isSponsored     Boolean        @default(false)
  pointType       PointType      @default(NEW)
  photoConfidence Int            @default(100)
  belongsToRoute  String?        @db.VarChar(255)
  notes           String?        @db.Text

  // Images
  images LocationImage[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([status])
  @@index([city])
  @@index([category])
  @@index([createdAt])
}

model LocationImage {
  id         String   @id @default(cuid())
  locationId String
  location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)
  url        String   @db.Text
  createdAt  DateTime @default(now())

  @@index([locationId])
}

model City {
  id            String         @id @default(cuid())
  nameAr        String
  nameEn        String
  governorate   String
  createdAt     DateTime       @default(now())
  neighborhoods Neighborhood[]
}

model Neighborhood {
  id        String   @id @default(cuid())
  nameAr    String
  nameEn    String?
  cityId    String
  createdAt DateTime @default(now())
  city      City     @relation(fields: [cityId], references: [id], onDelete: Cascade)
}
